<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La 12 - Gesti√≥n de Puntos</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --oro: #ffcc00; --fondo: #1a1a1a; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: url('public/images/la12.jpeg') no-repeat center center fixed; 
            background-size: cover;
            color: white; margin: 0; padding: 20px;
        }
        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: -1;
        }
        .nav { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; background: #333; color: white; transition: 0.3s; }
        button.active { background: var(--oro); color: black; font-weight: bold; }
        
        .seccion { display: none; background: rgba(30, 30, 30, 0.9); padding: 20px; border-radius: 10px; max-width: 800px; margin: 0 auto; box-shadow: 0 4px 20px rgba(0,0,0,0.8); }
        .active-section { display: block; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #444; text-align: center; }
        th { color: var(--oro); background: rgba(0,0,0,0.3); }

        .controles { text-align: center; margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #555; background: #222; color: white; margin: 5px; }
        
        /* Estilos Calendario */
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
       .dia { 
    padding: 15px 0; /* M√°s espacio para tocar con el dedo */
    border-radius: 8px; 
    cursor: pointer; 
    font-size: 1em; 
    background: rgba(255,255,255,0.05); 
    transition: 0.2s;
}
.dia:active { transform: scale(0.9); } /* Efecto de click */
        .con-evento { background: var(--oro) !important; color: black; font-weight: bold; }
        
        .galeria-grid img { 
    width: 100%; height: 100px; object-fit: cover; 
    border-radius: 6px; border: 1px solid #333; 
    transition: transform 0.2s; 
    cursor: pointer; /* Esto pone la manito al pasar el mouse */
}
.galeria-grid img:hover { transform: scale(1.05); filter: brightness(1.2); }
        .galeria img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; border: 1px solid #444; }

        .historial-item { border-left: 4px solid var(--oro); padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border-radius: 0 8px 8px 0; text-align: left; }
        .fecha { font-size: 0.75em; color: var(--oro); font-weight: bold; }
        /* Estilos de la Card de Evento */
.event-card {
    background: rgba(40, 40, 40, 0.95);
    border: 2px solid var(--oro);
    border-radius: 15px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.event-card-header { text-align: center; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 15px; }
.event-card-header h2 { font-size: 2em; color: var(--oro); margin: 0; text-transform: uppercase; letter-spacing: 1px; }

.badge { background: #444; padding: 4px 12px; border-radius: 20px; font-size: 0.8em; color: var(--oro); display: inline-block; margin-top: 5px; }

.event-actions { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }

.btn-puntos, .btn-subir { 
    background: #333; color: white; border: 1px solid #555; padding: 10px 15px; 
    border-radius: 8px; font-size: 0.9em; cursor: pointer; transition: 0.3s;
}
.btn-puntos:hover { background: var(--oro); color: black; }
.btn-subir { background: #28a745; border: none; } /* Verde para resaltar subida */

/* Galer√≠a tipo Instagram/Pinterest */
.galeria-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
    gap: 8px; 
}
.galeria-grid img { 
    width: 100%; height: 100px; object-fit: cover; 
    border-radius: 6px; border: 1px solid #333; 
    transition: transform 0.2s; cursor: pointer;
}
.galeria-grid img:hover { transform: scale(1.05); z-index: 2; }

.btn-eliminar { width: 100%; background: none; color: #ff4444; border: 1px dashed #ff4444; margin-top: 20px; font-size: 0.8em; }
        .foto-galeria {
    width: 100%;
    height: 100px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #333;
    display: block;
    cursor: pointer;
}
        .sortable-ghost {
    opacity: 0.4;
    background: var(--oro) !important;
}

.handle {
    user-select: none;
    -webkit-user-select: none;
}
    </style>
</head>
<body>

    <h1>üèÜ La 12 - Gesti√≥n de Puntos</h1>

    <div class="nav">
        <button onclick="ver('tabla')" id="btn-tabla" class="active">Tabla</button>
        <button onclick="ver('historial')" id="btn-historial">Historial</button>
        <button onclick="ver('reglamento')" id="btn-reglamento">Reglamento</button>
        <button onclick="ver('eventos')" id="btn-eventos">üìÖ Eventos</button>
    </div>

    <div class="controles">
        <input type="password" id="password" placeholder="Clave del Dios">
        <button onclick="validarYGuardarClave()" style="background: #444;">Acceder</button>
        <p id="status-clave" style="font-size: 0.8em; margin-top: 5px; color: #aaa;">Acceso requerido para editar.</p>
    </div>

    <div id="tabla" class="seccion active-section">
        <table>
            <thead><tr><th>Nombre</th><th>Puntos</th><th>Asistencias</th></tr></thead>
            <tbody id="tabla-cuerpo"></tbody>
        </table>
        <div id="controles-admin" style="margin-top:20px; border-top: 1px solid #444; padding-top:15px;">
            <input type="text" id="nuevo-nombre" placeholder="Nombre nuevo" disabled>
            <button id="btn-agregar" onclick="agregarJugador()" style="background: var(--oro); color: black; opacity: 0.5; cursor: not-allowed;" disabled>Agregar nuevo Therian</button>
        </div>
    </div>

    <div id="historial" class="seccion">
        <input type="text" id="filtro-historial" placeholder="Filtrar por nombre o fecha..." onkeyup="renderHistorial()" style="width: 90%; margin-bottom: 15px;">
        <div id="lista-historial"></div>
    </div>

<div id="reglamento" class="seccion">
    <h3>‚öñÔ∏è Reglamento de La 12</h3>
    <div id="lista-reglamento" style="text-align: left; margin-bottom: 20px;"></div>
    
    <div id="controles-reglamento" style="border-top: 1px solid #444; padding-top: 15px; display: none;">
        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
            <input type="text" id="nuevo-regla-txt" placeholder="Nueva regla (ej: No traer parlante)" style="flex-grow: 1;">
            <input type="number" id="nuevo-regla-pts" placeholder="Pts" style="width: 60px;">
            <button onclick="agregarReglaNueva()" style="background: var(--oro); color: black; font-weight: bold;">A√±adir</button>
        </div>
        <p style="font-size: 0.7em; color: #888; margin-top: 10px;">* Hac√© click en el texto de una regla para editarla (solo Dioses).</p>
    </div>
</div>

    <div id="eventos" class="seccion">
        <div id="calendario-mini">
            <div class="cal-header">
                <button onclick="cambiarMes(-1)">‚óÄ</button>
                <h3 id="mes-anio"></h3>
                <button onclick="cambiarMes(1)">‚ñ∂</button>
            </div>
            <div id="dias-reducidos" class="cal-grid"></div>
        </div>

     <div id="visor-evento" class="event-card" style="display:none;">
    <div class="event-card-header">
        <h2 id="titulo-evento-sel"></h2>
        <span id="fecha-badge" class="badge"></span>
    </div>
    
    <div class="event-actions">
        <button id="btn-ver-historial-ev" class="btn-puntos">üìä Ver Puntos de este d√≠a</button>
        <label class="btn-subir">
            üì∏ Subir a la Galer√≠a
            <input type="file" id="input-foto" accept="image/*" style="display:none;" onchange="subirFotoDirecta()">
        </label>
    </div>

    <div class="galeria-container">
        <p style="font-size: 0.8em; color: #aaa; margin-bottom: 10px;">Galer√≠a de la juntada:</p>
        <div id="galeria-fotos" class="galeria-grid"></div>
    </div>

    <button id="btn-borrar-ev" onclick="borrarEventoActual()" class="btn-eliminar" style="display:none;">Eliminar Juntada</button>
</div>

        <div id="controles-eventos" style="display:none; border-top:1px solid #444; margin-top:15px; padding-top:10px;">
            <input type="text" id="nombre-evento" placeholder="Nombre de la juntada" style="width:55%">
            <input type="date" id="fecha-evento" style="width:35%">
            <button onclick="crearEvento()" style="background:var(--oro); color:black;">Crear</button>
        </div>
    </div>
    <div id="lightbox" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:1000; justify-content:center; align-items:center; cursor:zoom-out;" onclick="this.style.display='none'">
    <span style="position:absolute; top:20px; right:30px; font-size:40px; color:white; font-weight:bold; cursor:pointer;">&times;</span>
    <img id="foto-grande" src="" style="max-width:95%; max-height:95%; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.5);">
</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCLa7nhMTqvOV5QuQdsfmKAGKHvjv4aEfI",
            databaseURL: "https://tabla-la12-default-rtdb.firebaseio.com",
            projectId: "tabla-la12",
            appId: "1:614852547098:web:3298faf37fe28d965df7a3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const CLAVE_OCULTA = "dGhlcmlhbnM="; // Clave: therians
        
        let cacheHistorial = [];
        let fechaVisual = new Date();
        let eventosCache = {};
        let eventoSeleccionadoId = null;

        // --- SEGURIDAD ---
        window.validarYGuardarClave = () => {
            const input = document.getElementById('password').value.trim().toLowerCase();
            const status = document.getElementById('status-clave');
            
            if(btoa(input) === CLAVE_OCULTA) {
                sessionStorage.setItem('acceso_v12', 'ok');
                status.innerText = "‚úÖ Bienvenido, Dios de la tabla.";
                status.style.color = "#44ff44";
                document.getElementById('password').value = "";
                habilitarEdicion();
            } else {
                alert("Clave incorrecta.");
            }
        };

        const obtenerAcceso = () => sessionStorage.getItem('acceso_v12') === 'ok';

        function habilitarEdicion() {
            if(!obtenerAcceso()) return;
            document.getElementById('nuevo-nombre').disabled = false;
            document.getElementById('btn-agregar').disabled = false;
            document.getElementById('btn-agregar').style.opacity = "1";
            document.getElementById('btn-agregar').style.cursor = "pointer";
            document.getElementById('controles-reglamento').style.display = "block";
            document.getElementById('controles-eventos').style.display = "block";
            renderCalendario(); // Refrescar para mostrar bot√≥n borrar si aplica
        }

        // --- NAVEGACI√ìN ---
        window.ver = (id) => {
            document.querySelectorAll('.seccion').forEach(s => s.classList.remove('active-section'));
            document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active-section');
            document.getElementById('btn-' + id).classList.add('active');
        };

        // --- TABLA ---
        onValue(ref(db, 'jugadores'), (snap) => {
            const data = snap.val();
            const tabla = document.getElementById('tabla-cuerpo');
            if (!tabla) return;
            tabla.innerHTML = '';
            const lista = [];
            for (let id in data) lista.push({id, ...data[id]});
            lista.sort((a,b) => b.puntos - a.puntos);
            lista.forEach(j => {
                const fila = document.createElement('tr');
                fila.innerHTML = `
                    <td><b>${j.nombre}</b></td>
                    <td contenteditable="${obtenerAcceso()}" onblur="modificar('${j.id}', 'puntos', this.innerText, ${j.puntos}, '${j.nombre}')">${j.puntos}</td>
                    <td contenteditable="${obtenerAcceso()}" onblur="modificar('${j.id}', 'asistencias', this.innerText, ${j.asistencias}, '${j.nombre}')">${j.asistencias}</td>`;
                tabla.appendChild(fila);
            });
        });

        window.modificar = async (id, campo, nuevoVal, viejoVal, nombre) => {
            const num = parseInt(nuevoVal);
            if (isNaN(num) || num === viejoVal) return;
            if (!obtenerAcceso()) { alert("Sin clave!"); location.reload(); return; }

            const motivo = prompt(`Motivo para ${nombre}:`);
            if (!motivo) { location.reload(); return; }

            await update(ref(db, `jugadores/${id}`), { [campo]: num });
            await push(ref(db, 'historial'), {
                jugadorNombre: nombre, campo, antes: viejoVal, ahora: num, diff: num - viejoVal,
                comentario: motivo, fecha: new Date().toLocaleString('es-AR')
            });
        };

        window.agregarJugador = async () => {
            const nombre = document.getElementById('nuevo-nombre').value.trim();
            if (!nombre || !obtenerAcceso()) return;
            const id = nombre.toLowerCase().replace(/\s/g, '_');
            await set(ref(db, `jugadores/${id}`), { nombre, puntos: 0, asistencias: 0 });
            document.getElementById('nuevo-nombre').value = '';
        };

        // --- HISTORIAL ---
        onValue(ref(db, 'historial'), (snap) => {
            cacheHistorial = snap.val() ? Object.values(snap.val()).reverse() : [];
            renderHistorial();
        });

        window.renderHistorial = () => {
            const filtro = document.getElementById('filtro-historial').value.toLowerCase();
            const div = document.getElementById('lista-historial');
            div.innerHTML = '';
            cacheHistorial.filter(h => h.jugadorNombre.toLowerCase().includes(filtro) || h.fecha.includes(filtro)).forEach(h => {
                const color = h.diff > 0 ? "#ff4444" : "#44ff44";
                div.innerHTML += `
                    <div class="historial-item">
                        <div class="fecha">${h.fecha}</div>
                        <b>${h.jugadorNombre}</b>: <span style="color:${color}">${h.diff > 0 ? '+'+h.diff : h.diff} ${h.campo}</span>
                        <div style="font-size:0.8em; opacity:0.7;">"${h.comentario}"</div>
                    </div>`;
            });
        };

        // --- REGLAMENTO ---
// --- REGLAMENTO (CORREGIDO) ---
        let reglasCache = [];
        let sortableInstance = null;

        onValue(ref(db, 'reglamento'), (snap) => {
            const data = snap.val();
            const div = document.getElementById('lista-reglamento');
            if (!div) return;
            div.innerHTML = '';
            if (!data) return;

            reglasCache = Object.entries(data).map(([id, val]) => ({ id, ...val }));
            reglasCache.sort((a, b) => a.orden - b.orden);

            reglasCache.forEach((regla, index) => {
                const esAdmin = obtenerAcceso();
                const item = document.createElement('div');
                item.className = 'regla-item';
                item.setAttribute('data-id', regla.id);
                item.style = `display:flex; align-items:center; background:rgba(255,255,255,0.05); margin-bottom:8px; padding:12px; border-radius:8px; border-left: 3px solid var(--oro);`;

                item.innerHTML = `
                    <div style="flex-grow:1;">
                        <span class="indice-regla" style="color:var(--oro); font-weight:bold; margin-right:8px;">${index + 1}.</span> 
                        <span ${esAdmin ? `contenteditable="true" onblur="actualizarRegla('${regla.id}', 'texto', this.innerText)"` : ''} style="outline:none;">${regla.texto}</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <span style="background:rgba(255,204,0,0.2); color:var(--oro); padding:2px 8px; border-radius:5px; font-weight:bold;">
                            +<span ${esAdmin ? `contenteditable="true" onblur="actualizarRegla('${regla.id}', 'puntos', this.innerText)"` : ''}>${regla.puntos}</span>
                        </span>
                        ${esAdmin ? `
                            <button onclick="borrarRegla('${regla.id}')" style="color:#ff4444; background:none; border:none; cursor:pointer; font-size:1.2em;">‚úï</button>
                            <div class="handle" style="cursor:grab; font-size:1.5em; color:var(--oro); margin-left:5px; padding:10px; touch-action:none;">‚ò∞</div>
                        ` : ''}
                    </div>`;
                div.appendChild(item);
            });

            if (sortableInstance) sortableInstance.destroy();

            if (obtenerAcceso()) {
                sortableInstance = new Sortable(div, {
                    handle: '.handle',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    forceFallback: true,
                    fallbackOnBody: true,
                    onEnd: async () => {
                        const items = div.querySelectorAll('.regla-item');
                        const updates = {};
                        items.forEach((el, index) => {
                            const id = el.getAttribute('data-id');
                            updates[`reglamento/${id}/orden`] = index;
                        });
                        await update(ref(db), updates);
                    }
                });
            }
        });

        window.agregarReglaNueva = async () => {
            const txt = document.getElementById('nuevo-regla-txt').value.trim();
            const pts = document.getElementById('nuevo-regla-pts').value || 0;
            if (txt && obtenerAcceso()) {
                const nuevoOrden = reglasCache.length > 0 ? reglasCache[reglasCache.length - 1].orden + 1 : 0;
                await push(ref(db, 'reglamento'), { 
                    texto: txt, 
                    puntos: parseInt(pts), 
                    orden: nuevoOrden 
                });
                document.getElementById('nuevo-regla-txt').value = '';
                document.getElementById('nuevo-regla-pts').value = '';
            } else if (!obtenerAcceso()) {
                alert("¬°Epa! No ten√©s la clave del Dios.");
            }
        };

        window.actualizarRegla = async (id, campo, valor) => {
            if (!obtenerAcceso()) return;
            let v = valor;
            if (campo === 'puntos') v = parseInt(valor) || 0;
            await update(ref(db, `reglamento/${id}`), { [campo]: v });
        };

        window.borrarRegla = async (id) => {
            if (obtenerAcceso() && confirm("¬øEliminar esta regla?")) {
                await set(ref(db, `reglamento/${id}`), null);
            }
        };

        // --- CALENDARIO Y EVENTOS ---
        window.cambiarMes = (dir) => { fechaVisual.setMonth(fechaVisual.getMonth() + dir); renderCalendario(); };

        function renderCalendario() {
            const grid = document.getElementById('dias-reducidos');
            const mesAnio = document.getElementById('mes-anio');
            if(!grid) return;
            grid.innerHTML = '';
            
            const mes = fechaVisual.getMonth();
            const anio = fechaVisual.getFullYear();
            mesAnio.innerText = fechaVisual.toLocaleString('es-AR', { month: 'long', year: 'numeric' });

            let primerDia = new Date(anio, mes, 1).getDay();
            for(let i=0; i < (primerDia === 0 ? 6 : primerDia - 1); i++) grid.innerHTML += '<div></div>';

            let diasEnMes = new Date(anio, mes + 1, 0).getDate();
            for(let d=1; d <= diasEnMes; d++) {
                let fechaStr = `${anio}-${String(mes+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                let div = document.createElement('div');
                div.className = 'dia' + (eventosCache[fechaStr] ? ' con-evento' : '');
                div.innerText = d;
                div.onclick = () => verEvento(fechaStr);
                grid.appendChild(div);
            }
        }

        onValue(ref(db, 'eventos'), (snap) => {
            const data = snap.val() || {};
            eventosCache = {};
            for(let id in data) eventosCache[data[id].fecha] = { id, ...data[id] };
            renderCalendario();
        });

window.verEvento = (fechaStr) => {
    const ev = eventosCache[fechaStr];
    const visor = document.getElementById('visor-evento');
    if(!ev) { visor.style.display = 'none'; return; }
    
    eventoSeleccionadoId = ev.id;
    visor.style.display = 'block';
    
    // T√≠tulo y Fecha
    document.getElementById('titulo-evento-sel').innerText = ev.nombre;
    const fLoc = new Date(fechaStr + "T00:00:00").toLocaleDateString('es-AR', { day: 'numeric', month: 'long' });
    document.getElementById('fecha-badge').innerText = fLoc; // Seteamos el badge
    
    document.getElementById('btn-ver-historial-ev').onclick = () => {
        const fechaFiltro = new Date(fechaStr + "T00:00:00").toLocaleDateString('es-AR');
        document.getElementById('filtro-historial').value = fechaFiltro;
        renderHistorial();
        ver('historial');
    };
    
    document.getElementById('btn-borrar-ev').style.display = obtenerAcceso() ? 'block' : 'none';
    cargarFotos(ev.id);
};

// Busc√° esta parte y reemplazala:
window.crearEvento = async () => {
    const inputNombre = document.getElementById('nombre-evento');
    const inputFecha = document.getElementById('fecha-evento');
    const n = inputNombre.value;
    const f = inputFecha.value;

    if(n && f && obtenerAcceso()) {
        await push(ref(db, 'eventos'), { nombre: n, fecha: f });
        // Limpiamos los campos despu√©s de crear para que no se dupliquen
        inputNombre.value = '';
        inputFecha.value = '';
        alert("‚úÖ Evento agendado!");
    } else {
        alert("Falta el nombre, la fecha o poner la clave rray.");
    }
};
        window.borrarEventoActual = async () => {
            if(confirm("¬øBorrar juntada?") && obtenerAcceso()) {
                await set(ref(db, `eventos/${eventoSeleccionadoId}`), null);
                await set(ref(db, `fotos/${eventoSeleccionadoId}`), null);
                document.getElementById('visor-evento').style.display = 'none';
            }
        };

        window.subirFotoDirecta = () => {
            const file = document.getElementById('input-foto').files[0];
            if (!file || !eventoSeleccionadoId) return;
            const reader = new FileReader();
            reader.onloadend = async () => {
                await push(ref(db, `fotos/${eventoSeleccionadoId}`), reader.result);
                alert("Foto lista!");
            };
            reader.readAsDataURL(file);
        };

function cargarFotos(evId) {
    onValue(ref(db, `fotos/${evId}`), (snap) => {
        const div = document.getElementById('galeria-fotos');
        div.innerHTML = '';
        const data = snap.val();
        
        if (!data) {
            div.innerHTML = '<p style="font-size:0.8em; color:#666;">No hay fotos todav√≠a.</p>';
            return;
        }

        for (let id in data) {
            const imgUrl = data[id];
            const fotoId = id; // El ID √∫nico de la foto en Firebase

            // Contenedor para la foto y el bot√≥n de borrar
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';

            const imgElement = document.createElement('img');
            imgElement.src = imgUrl;
            imgElement.className = 'foto-galeria'; // Usamos clase para el CSS
            imgElement.onclick = () => {
                document.getElementById('foto-grande').src = imgUrl;
                document.getElementById('lightbox').style.display = 'flex';
            };
            
            wrapper.appendChild(imgElement);

            // SI ES ADMIN, agregamos el bot√≥n de borrar
            if (obtenerAcceso()) {
                const btnBorrar = document.createElement('button');
                btnBorrar.innerHTML = 'üóëÔ∏è';
                btnBorrar.style = `
                    position: absolute; top: 5px; right: 5px; 
                    background: rgba(255,0,0,0.7); border: none; 
                    border-radius: 50%; color: white; cursor: pointer;
                    padding: 5px; font-size: 10px; z-index: 10;
                `;
                btnBorrar.onclick = (e) => {
                    e.stopPropagation(); // Para que no se abra la foto al tocar borrar
                    if(confirm("¬øBorrar esta foto para siempre?")) {
                        set(ref(db, `fotos/${evId}/${fotoId}`), null);
                    }
                };
                wrapper.appendChild(btnBorrar);
            }

            div.appendChild(wrapper);
        }
    });
}

        // Inicio
        renderCalendario();
        if(obtenerAcceso()) habilitarEdicion();

    </script>
</body>
</html>
